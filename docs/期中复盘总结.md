> 在计算机诞生之初，我们的先驱想让计算机之间都能互相通信，现在让你来帮他实现这个小小的心愿

这个问题的核心子问题是：如何实现两台计算机之间的相互通信 ？

![image-20220419094822728](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220419094822728.png)

#### 直连

显然，一个最简单的想法就是用一根电线将它俩连起来，然后它们之间就能通过这根电线进行相互通信了（发送高低电平来表示数据信息）

![image-20220419094116555](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220419094116555.png)

这就是一个最最简单的计算机网络～

#### 直连的不足

顺着这个思路，我们来看看当计算机逐渐增多，且它们两两之间都需能相互通信时，会不会出现什么问题

![directly-connect](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/directly-connect.gif)

不难看出，按照上面的思路，每增加一台计算机，新增的计算机就需要和其他所有计算机之间都连一根线

可以想像，如果按照这种思路，那么当计算机越来越多，所需的线材数量就会急剧增长（成本高昂）🧶 ⬆️ 💰 ⬆️，线材的连接也会错综复杂🖇

```
打个比喻，在上古欧亚大陆存在几个充满了神话色彩的古老城邦，它们独立于不同地域，相互没有往来

某天，城邦 A 和 B 想要互通商路，以期日后共同繁荣，于是这两个城邦之间就建立了一条茶马古道

不久后，城邦 C 想要加入城邦 AB 之间的商贸往来，于是古道 CA 和 CB 被建设了起来

...

日久天长，越来越多的城邦想要加入这种共同繁荣，但越是后来的城邦，它们的君王就越是纠结

纠结难道我想加入他们，就得和他们每个城邦都建立一条商路吗 ？无数良田美景都铺成错综复杂的商路了这怎么行 ？！而且成本也太大了 ！拒绝 ！

...
```

> 所以这种思路只适合极小规模的计算机网络的布置，比如只有两三台计算机需要互相通信

#### 转发

```
就在众君王一筹莫展之际，一位须发皆白的老者站了起来，徐徐说道：

“
  不如就在我们几个城邦之间建一个中转站吧，这样我们就都只需修一条商路，连接至该中转站
  任何城邦都可派遣商队，经由该中转站去往其他城邦，如此一来问题就解决了
”

大家拍手称快👏
```

将这种改进思路应用到计算机网络的设计，就诞生了第一个重要的网络设备 => `集线器` ！

计算机可以连接到集线器上，集线器可以转发计算机发来的数据包，计算机网络就被改造成了下图这样

![image-20220419113155343](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220419113155343.png)

> 集线器扛起了转发的任务，大大减少了线材的用量降低了成本，也使得线材的连接方式简洁

#### 集线器的运作方式

```
由于众君王迫切需要老者所说的中转站

于是短短几天，一个简陋的中转站就被建立起来并投入了使用

为什么说它简陋呢，因为：

  1. 这个中转站除有 N 个大门，分别连接 N 个城邦外，就只剩一个复制机和一个骑兵营

  2. 当有一个城邦送来了文书需要送往另一个城邦，这份文书就会被复制成 N-1 份分别从其他 N-1 个大门快马送出

  3. 当其他城邦收到文书后，会根据文书是否是发给自己的来决定是否接受该文书（是就要，不是就扔）

但很快就出现了问题：

  由于中转站往往会同时收到好几个城邦送来的文书，但骑兵只是将这些文书草草地混合到一起后复制送出

  导致没有城邦能认得文书是否是发给自己的

于是各城邦做了一个约定：

  一次只能有一个城邦发送文书，轮流来，没轮到的城邦需要等待
```

这正是集线器的运作方式：

  1. 集线器收到的数据包会被同时转发给其它所有计算机，由接收到数据包的计算机来决定是否接受该数据包（所以集线器设计简单且价格便宜，线材也只需双绞线）

  2. 采用 CSMA/CD 协议来避免数据信号的冲突

#### 集线器的不足

1. 盲目广播，导致带宽利用率低

2. 由于链路上同时只能有一个计算机发送数据，随着加入计算机网络的计算机持续增多，链路的利用率会越来越低

    - 很多计算机可能好久都轮不到一次发送数据包的机会

> 所以集线器也只适用于小规模计算机网络的布置

#### 交换机诞生

![image-20220419171239887](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220419171239887.png)

![image-20220419171447567](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220419171447567.png)

> 交换机完美替代集线器，在局域网内工作高效
>
> 但随着网络规模不断扩大，只使用交换机就会显得力不从心，甚至可能导致「消息泛洪」
>
> 互联网的目的是实现跨局域网的全球互连互通，连通两个网络成为急需解决的问题

#### 引子

##### 路由器的诞生

- 路由器扛起了连通不同网络形成更大的网络，实现计算机跨网络高效通信的任务

![image-20220412111853694](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220412111853694.png)

- 为简单起见，可以只画路由器，将网络省略

![image-20220412112011582](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220412112011582.png)

##### IP 地址的提出

- 数据链路层使用 MAC 地址做局域网内的网络通信

- 网络层负责处理跨网络通信（使用既能标识设备，又能标识网络的 IP 地址）

- IP 到 MAC 的转换使用 ARP 协议

#### 参考了

> 本视频已备份

<iframe width="616" height="347" src="//player.bilibili.com/player.html?aid=66929320&bvid=BV124411k7uV&cid=116062245&page=1" title="Lecture 1: Course Overview + The Shell (2020)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

