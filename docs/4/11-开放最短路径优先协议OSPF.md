- 开放最短路径优先协议（`O`pen`S`hortest`P`ath`F`irst）诞生于 1989 年，其目标是克服 RIP 的缺点

  - “开放” 是指该协议**公开发表**，不受任何厂家控制

  - “最短路径优先” 是指该协议**使用了 Dijkstra 提出的最短路径算法**（用该算法计算路由，确保了**不会产生路由环路**）

- OSPF **基于链路状态**，而不像 RIP 那样基于距离向量

  - 链路状态是指：（本路由器都和哪些路由器相邻 & 相应链路的“代价”）

    - “代价” 由网络管理人员来决定，比如（距离、带宽、时延、费用、...）

> OSPF 不限制网络规模，更新效率高，收敛速度快

#### 举例

##### “代价” 的计算方式

在思科路由器中，“代价” 的计算方式为：100Mbps / 链路带宽

计算结果小于 1 的话仍记为 1；大于 1 且有小数的，舍去小数

![image-20220426170152128](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220426170152128.png)

##### “邻居关系”

每个路由器都会建立一张邻居表，相邻路由器之间通过交互**问候分组 Hello**来建立和维护邻居关系

![image-20220426170655139](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220426170655139.png)

##### “问候分组”

- 问候分组被封装在 IP 数据报中，发往多播地址 224.0.0.5

  - IP 数据报首部中的协议号字段的值应为 89，表示 IP 数据报的数据载荷为 OSPF 分组

    ![image-20220426170921637](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220426170921637.png)

- 问候分组的发送周期为 10 秒，若 40 秒还未收到来自邻居路由器的 Hello 分组，则认为该邻居路由器不可达

##### “邻居表”

- 下图是路由器 R1 的邻居表（为简单起见，邻居 ID 简记为 RX，实践中应填写具体的路由器 ID）

  - 假设邻居 R2 的死亡倒计时还剩 36 秒，若在死亡倒计时到达 0 之前收到了来自 R2 的问候分组，则重新启动针对该邻居条目的 40 秒死亡倒计时

  - 否则，当死亡倒计时为 0 时，就会判定该邻居路由器不可达

![image-20220426172310536](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220426172310536.png)

##### 链路状态通告

![image-20220426175245585](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220426175245585.png)

- 链路状态通告 LSA 被封装在**链路状态更新分组 LSU** 中，采用洪泛法发送

  - 收到链路状态更新分组 LSU 的路由器，会将该分组从自己的其它所有接口转发出去，这就是洪泛转发

  - 这样一来，自治系统中的每个路由器所发送的链路状态更新分组，都会被传递给系统中的其它所有路由器

##### 链路状态数据库


