- 实际的通信链路都是不理想的，比特流在传输过程中会受到各种干扰

- 这就有可能导致比特差错（即：1 可能变成 0，0 可能变成 1）

- 这也叫「误码」

![image-20220316104556545](https://gitee.com/pj-l/imgs-1/raw/master/image-20220316104556545.png)

- 在一段时间内，传输错误的比特占所传输比特总数的比率称为「误码率 BER（`B`it `E`rror `R`ate）」

> 接收方的数据链路层使用「差错检测码」来检测数据在传输过程中是否产生了误码，是数据链路层所要解决的重要问题之一

- 例如：

	- 下图是以太网版本2的MAC帧格式

	- 其帧尾包含了一个长度为 4 字节的帧检验序列FCS（`F`rame `c`heck `s`equence）字段，其作用就是让接收方的数据链路层检查帧在传输过程中是否产生了误码

![image-20220316105145854](https://gitee.com/pj-l/imgs-1/raw/master/image-20220316105145854.png)

- 例如：

	- 下图是点对点协议PPP的帧格式

	- 其帧尾中包含了一个长度为 2 字节的帧检验序列FCS字段，其作用也是让接收方的数据链路层检查帧在传输过程中是否产生了误码

![image-20220316105557164](https://gitee.com/pj-l/imgs-1/raw/master/image-20220316105557164.png)

##### 1. 奇偶校验

> 这是一种比较简单的检错方法
>
> 在待发送的数据后面添加 1 位奇偶校验位，使整个数据（包括所添加的校验位在内）中「1」的个数为奇数（奇校验）或偶数（偶校验）

- 举个例子

- 在下图中，收发双发决定采用奇校验，为了使比特 1 的总数为奇数，则在数据后面添加的校验位应该为比特 1

  - 假设传输过程中出现了 1 位误码（下图中的红色六边形）

    - 那么接收方对收到的比特流进行奇校验，就会发现比特 1 的总数为偶数

    - 这样接收方就知道传输过程中出现了误码

  - 但如果传输过程中出现了 2 位误码

  	- 那么接收方对收到的比特流进行奇校验，就会发现比特 1 的总数为奇数

		- 接收方就会误认为传输过程中没有发生误码

![image-20220317104152290](https://gitee.com/pj-l/imgs-1/raw/master/image-20220317104152290.png)

> 偶校验同理

- 总结：采用奇偶校验

	- 如果有奇数个位发生误码，则奇偶性会发生变化，就可以检查出是否有误码

	- 如果有偶数个位发生误码，则奇偶性不变，就无法检查出是否有误码（漏检）

> 显然：奇偶校验的「漏检率」比较高 ⬆️
>
> 因此：计算机网络的数据链路层一般不会采用这种检测方法

##### 2. 循环冗余校验 CRC（`C`yclic `R`edundancy `C`heck）

- 检错的大致步骤为：

	1. 收发双方会提前约定好一个（各项系数不是 0 就是 1 的）多项式，学术上叫「生成多项式」

	<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220317151429090.png" alt="image-20220317151429090" style="zoom:50%;" />

	2. 然后，发送方会基于（待发送的数据 & 生成多项式）计算出差错检测码，也就是所谓的「冗余码」；这个冗余码会被添加到待发送数据的后面，一起发送

	3. 接收方会依据之前已经约定好的生成多项式，检测接收到的比特流是否存在误码
	
- 具体的检错步骤如下：

	- 发送方使用「一种特殊的除法」来计算冗余码

	- 被除数由（待发送的数据 & 生成多项式的最高次个 0）组成

	- 除数由生成多项式各项的系数组成

	<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220317151152663.png" alt="image-20220317151152663" style="zoom:60%;" />

	- 得到商和余数
	
	- 商仅作为标记（1 表示够除，0 表示不够除），用于防止计算过程中对错位
	
	- 余数就是计算出的冗余码，即：差错检测码，将其添加到待发送数据的后面，一起发送
	
	> 注意：冗余码的长度 == 生成多项式的最高次的次数
	
	- 接收方也是做除法
	
	- 帧作为被除数
	
	- 除数由生成多项式各项的系数组成
	
	- 得到商和余数
	
	> 如果余数为 0，就判定传输过程中没有产生误码；否则判定传输过程中有误码

![image-20220317145819402](https://gitee.com/pj-l/imgs-1/raw/master/image-20220317145819402.png)

---

- 循环冗余校验 CRC 是一种检错能力很强的检测方法，漏检率极低 ！（当然也有漏检的情况哈，下文的微信聊天截图中已做说明）

- 其次，虽然这种检测方法的计算稍显复杂，但却非常容易用硬件实现

- 因此，这种检错方法被广泛应用于数据链路层～

---

> 注意：
> 
> 差错检测码只能检测出帧在传输过程中是否出现了误码，但无法定位误码，因此无法纠正误码 ！

- 要想纠正，可以使用冗余信息更多的「纠错码」进行「前向纠错」，但是开销太大了，因而在计算机网络中较少使用

> 在计算机网络中，通常（采用「检错重传」的方式来纠正传输中的误码 || 仅仅丢弃含有误码的帧）
>
> 这取决于数据链路层向其上层提供的是可靠传输服务还是不可靠传输服务

![](https://gitee.com/pj-l/imgs-1/raw/master/1.jpg)

![](https://gitee.com/pj-l/imgs-1/raw/master/2.jpg)

![](https://gitee.com/pj-l/imgs-1/raw/master/3.jpg)

#### 练习题

> 注意，这是一种特殊的除法，商仅是一种标记，1 表示够除，0 表示不够除（特殊就特殊在所谓的够除和不够除不是十进制中的意思，而是比特串的位够不够亦或的意思）

![image-20220317152630021](https://gitee.com/pj-l/imgs-1/raw/master/image-20220317152630021.png)

![image-20220317153149924](https://gitee.com/pj-l/imgs-1/raw/master/image-20220317153149924.png)
