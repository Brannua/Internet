- 我们已经知道：使用差错检测技术（eg：循环冗余校验 CRC），接收方的数据链路层就可检测出帧在传输过程中是否产生了误码（比特错误）

- 那么接下来该如何处理呢 ？

> 这取决于数据链路层向其上层提供的是可靠传输服务还是不可靠传输服务

- 如果提供的是不可靠传输服务，则仅仅丢弃有误码的帧，其他什么也不做

- 可如果提供的是可靠传输服务，那么就得想办法实现发送端发送什么，接收端就能收到什么

---

- 例如：接收方可以给发送方发送一个「通知帧」，告诉它：“之前发送的帧产生了误码，请重发～”

- 发送方收到通知后，重新发送之前产生了误码的那个帧即可

- 实际上，可靠传输的实现，并没有这么简单 ！

- 试想一下，如果这个通知帧也出现了误码，又会怎么样呢 ？

---

#### 可靠传输的基本概念

- 一般情况下，有线链路的误码率比较低，所以，为了减小开销，并不要求其数据链路层向上层提供可靠传输服务，可靠传输的问题由其上层处理

![image-20220317160008186](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220317160008186.png)

- 然而，对于无线链路，由于其容易受到干扰，误码率比较高，因此，要求其数据链路层必须向上层提供可靠传输服务

![image-20220317160443966](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220317160443966.png)

> 需要说明的是：
> 
> 从整个计算机网络体系结构来看，传输差错包括（比特差错、分组丢失、分组重复、分组失序）

- 以下图为例：

	- 第 1 种情况：主机 H6 给主机 H2 发送的分组到达了路由器 R5，但此时 R5 的输入队列快慢了，R5 就会根据自己的分组丢弃策略主动丢弃该分组，这就是一种分组丢失的情况

	- 第 2 种情况：主机 H6 依次给主机 H2 发送了 3 个分组，但它们并没有按照发送的顺序依次到达主机 H2，也就是说，最先发送的分组未必最先到达

	- 第 3 种情况：主机 H6 给主机 H2 发送的分组，由于某些原因在网络中滞留了，没有及时到达主机 H2，这可能造成主机 H6 对该分组的「超时重发」，重发的分组到达主机 H2，一段时间后，滞留在网络中的那个分组又到达了主机 H2，这就会造成分组重复的传输差错

<img src="https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220317164905430.png" alt="image-20220317164905430" style="zoom:50%;" />

> （分组丢失、分组重复、分组失序）一般不会出现在数据链路层，而会出现在其上层
>
> 因此：可靠传输服务并不局限于数据链路层，其他各层均可选择实现可靠传输服务

- 例如下图是 TCP/IP 的 4 层体系结构

  - 如果网络接口层使用的是 802.11 无线局域网，那么其数据链路层就要求实现可靠传输

  - 如果网络接口层使用的是以太网，那么其数据链路层并不要求实现可靠传输

	- 网际层中的 IP 协议，向其上层提供的是（无连接、不可靠）的传输服务

	- 运输层中的

		- TCP 协议，向其上层提供的是（面向连接、可靠）的传输服务

		- UDP 协议，向其上层提供的是（无连接、不可靠）的传输服务

![image-20220317165011178](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220317165011178.png)

> 注意：可靠传输的实现比较复杂，开销也就较大，是否使用可靠传输取决于应用需求

#### 3 种可靠传输的实现机制

![image-20220317224757403](https://aliyun-oss-lpj.oss-cn-qingdao.aliyuncs.com/images/by-picgo/image-20220317224757403.png)
