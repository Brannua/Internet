#### 回顾

- 从 5 层协议的原理体系结构的角度来看，主机应具有体系结构中的各个层次，而路由器只需具有体系结构中的下面 3 层

- 各设备通过物理层下面的传输媒体进行互连

- 如下图所示，主机 H1 向主机 H2 发送数据

- 主机 H1 将待发送的数据逐层封装后，通过物理层将构成数据包的各比特转化为电信号，发送到传输媒体

- 数据包进入路由器后，由下往上逐层解封到网络层，路由器根据数据包的目的网络地址查找自身的转发表进而确定数据包的转发端口

- 然后从网络层向下逐层封装数据包，并通过物理层将数据包发送到传输媒体

- 数据包最终到达主机 H2，由下往上逐层解封，最终解封出主机 H1 发送的数据

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220314104159822.png" alt="image-20220314104159822" style="zoom:44%;" />

#### 仅从数据链路层来看

- 仅从数据链路层来看，从主机 H1 到 H2 的通信，可以从「逻辑上」看成在 4 段链路上的通信

- 所谓链路（Link），就是指从一个结点到相邻结点的一段物理线路（中间没有其他交换结点）

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220314104906720.png" alt="image-20220314104906720" style="zoom:45%;" />

- 要想在链路上传输数据，就需要「一些能控制数据传输的通信协议」

- 将实现这些通信协议的（硬件 & 软件）添加到链路上，就构成了「数据链路」 Data Link

- 在数据链路层上进行逻辑传输的数据包，被称为「帧」

> 即：数据链路层以「帧」为单位进行数据的处理和传输

#### 数据链路层的 3 个重要问题

> 以「点对点信道的数据链路层」为例

##### 1. 封装成帧

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315160952613.png" alt="image-20220315160952613" style="zoom:50%;" />

- 如图所示，两台主机通过一段链路互连，二者都会对收发的数据包进行 5 层的解封或封装

	- 发送方会将待发送的数据

	- 通过应用层封装成应用层协议数据单元，然后交给运输层

	- 运输层会为其添加运输层协议首部，使之成为运输层协议数据单元，然后交给网络层

	- 网络层会为其添加网络层协议首部，使之成为网络层协议数据单元，然后交给数据链路层

	- 数据链路层会为其添加帧头（数据链路层协议首部）和帧尾，确保在链路上以帧为单位进行数据传输

	- 数据链路层干的这些事儿，就被称为「封装成帧」

![image-20220315161048533](https://gitee.com/pj-l/imgs-1/raw/master/image-20220315161048533.png)

##### 2. 差错检测

- 发送方会将封装好的帧，通过物理层发送到传输媒体

- 帧在传输过程中可能会遭遇干扰而产生误码（也就是部分比特 0 变成了比特 1，反之亦然）

	<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315161328789.png" alt="image-20220315161328789" style="zoom:50%;" />

- 那么，接收方如何判断帧在传输过程中是否出现了误码呢 ？

- 这可以通过「检错码」来发现

	- 发送方在发送帧之前，基于（待发送的数据 & 检错算法）计算出检错码，并将其封装在帧尾

	- eg：以太网版本2的MAC帧的帧尾，就是 4 字节的「帧检验序列 FCS 字段」，被写入到该字段中的内容，就是我们所说的检错码

	<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315161834231.png" alt="image-20220315161834231" style="zoom:50%;" />

	- 接收方收到帧后，使用（检错码 & 检错算法），就可以判断传输过程中是否出现了误码

##### 3. 可靠传输

> 误码是无法避免的，但若能实现发送方发送什么，接收方就能收到什么，就称为可靠传输

- 接收方收到有误码的帧后，会主动将其丢弃（哼 ！）

	- 如果数据链路层向上层提供的是不可靠服务，那么丢弃就丢弃了，不会再有更多措施

	- 如果数据链路层向上层提供的是可靠服务，那么就还需要更多措施，来确保接收方能重新收到被丢弃的帧的正确副本

#### 使用广播信道的数据链路层（共享式局域网）

> 除了上述 3 个问题以外，还有其他一些需要解决的问题

- 如图所示，主机 A、B、C、D、E 通过一根总线互连

- 从逻辑上看，假设主机 A 给主机 C 发送帧，则代表帧的信号会通过总线传输到总线上的其他各个主机

- 那么主机 B、D、E 如何知道所收到的帧不是发送给它们的呢 ？主机 C 又如何知道所收到的帧是发送给自己的呢 ？

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315163447033.png" alt="image-20220315163447033" style="zoom:50%;" />

- 地址、编址（将帧的目的地址添加在帧中一起传输 ？）

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315163652630.png" alt="image-20220315163652630" style="zoom:65%;" />

---

- 另外，从逻辑上看，当总线上有多台主机同时使用总线传输帧时，传输信号就会发生碰撞

- 这是采用广播信道的共享式局域网所无法避免的

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315163857423.png" alt="image-20220315163857423" style="zoom:50%;" />

- 以太网采用的协调方法是：使用一种特殊的协议 CSMA/C`D`（载波监听多点接入/碰撞检测）

- 再比如，由于无线信道的广播天性，无线局域网使用的也是共享信道技术

- 例如：802.11 局域网采用的就是媒体接入控制协议 CSMA/C`A`（载波监听多点接入/碰撞避免）

> 可它的工作原理是怎样的呢 ？

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315164822438.png" alt="image-20220315164822438" style="zoom: 67%;" />

---

- 随着技术的发展，交换技术不断成熟，成本不断降低

- 在有线局域网领域，具有更高性能、使用点对点链路和链路层交换机的交换式局域网，已经完全取代了共享式局域网

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315164602755.png" alt="image-20220315164602755" style="zoom:50%;" />

> 那么，网络中的交换机又是如何转发帧的呢 ？

#### 总结一下数据链路层中的重要问题

<img src="https://gitee.com/pj-l/imgs-1/raw/master/image-20220315164921361.png" alt="image-20220315164921361" style="zoom:50%;" />
